# 如何实现延时队列？

## 前言

或许我们在开发时会遇到一些需求或者突发性的状况，需要依赖一种延时的手段进行解决：比如订单超时取消。

有经验的小伙伴就会知道，通常有两种方案实现这个目标。

1、将需要延时的任务存入到数据库，定时扫描数据库

2、使用MQ的延时队列功能，如RabbitMQ

但这两种方案都存在一些弊端

方案一: 定时扫描等同于轮询，存在误差，误差值在于多久轮询一次，如果是5s，那么误差就是(0,5]

方案二：如果系统本来就已经使用了MQ自然没有问题，但是没有MQ的情况下，为了实现延时任务的功能，上一个MQ是不太现实的事情。

所以大多数情况下我们都会委屈求全使用方案一。

## 思考

基于此类情况，难道就没有一个更好的解决方案吗？我们是否可以将MQ的延时功能移植到系统中呢？这样既可以不上MQ，又可以达到执行延时任务的精准性。

带着这样的思考，我们就要知道MQ是如何实现「延时消息」这一功能的。

## 时间轮

时间轮是一种非常适合基于时间调度任务的数据结构，它的结构如下：